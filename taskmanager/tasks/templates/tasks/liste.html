{% extends 'tasks/base.html' %}

{% block title %}Tableau de Bord â€” TaskMaster{% endblock %}

{% block content %}

<!-- â•â• EN-TÃŠTE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="page-header">
  <h1>ğŸ“‹ Mes <span class="accent">TÃ¢ches</span></h1>
  <a href="{% url 'ajouter_tache' %}" class="nav-btn nav-btn-primary" style="font-size:.95rem; padding:.65rem 1.4rem;">
    ï¼‹ Nouvelle tÃ¢che
  </a>
</div>

<!-- â•â• STATISTIQUES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•= -->
<div class="stats-grid">
  <div class="stat-card rouge">
    <div class="stat-number">{{ stats.total }}</div>
    <div class="stat-label">Total tÃ¢ches</div>
  </div>
  <div class="stat-card cafe">
    <div class="stat-number">{{ stats.en_cours }}</div>
    <div class="stat-label">En cours</div>
  </div>
  <div class="stat-card vert">
    <div class="stat-number">{{ stats.terminees }}</div>
    <div class="stat-label">TerminÃ©es</div>
  </div>
  <div class="stat-card brun">
    <div class="stat-number">{{ stats.haute_prio }}</div>
    <div class="stat-label">Haute prioritÃ©</div>
  </div>
</div>

<!-- â•â• FILTRES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<form class="filtres" method="GET">
  <label for="statut">Statut :</label>
  <select name="statut" id="statut">
    <option value="">â€” Tous â€”</option>
    <option value="en_cours"  {% if statut == 'en_cours'  %}selected{% endif %}>En cours</option>
    <option value="terminee"  {% if statut == 'terminee'  %}selected{% endif %}>TerminÃ©e</option>
  </select>

  <label for="priorite">PrioritÃ© :</label>
  <select name="priorite" id="priorite">
    <option value="">â€” Toutes â€”</option>
    <option value="faible"  {% if priorite == 'faible'  %}selected{% endif %}>Faible</option>
    <option value="moyenne" {% if priorite == 'moyenne' %}selected{% endif %}>Moyenne</option>
    <option value="haute"   {% if priorite == 'haute'   %}selected{% endif %}>Haute</option>
  </select>

  <button type="submit" class="btn-filtrer">ğŸ” Filtrer</button>
  <a href="{% url 'liste_taches' %}" class="btn-reset">âœ• RÃ©initialiser</a>
</form>

<!-- â•â• TABLEAU DES TÃ‚CHES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="table-wrapper">
  {% if taches %}
  <table class="taches-table">
    <thead>
      <tr>
        <th>Titre</th>
        <th>Description</th>
        <th>PrioritÃ©</th>
        <th>Statut</th>
        <th>Date</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for tache in taches %}
      <tr class="{% if tache.est_terminee %}terminee{% endif %}">
        <!-- Titre -->
        <td>
          <span class="titre-cell {% if tache.est_terminee %}terminee{% endif %}">
            {% if tache.est_haute_priorite %}ğŸ”´{% endif %}
            {{ tache.titre }}
          </span>
        </td>

        <!-- Description -->
        <td>
          <span class="desc-cell">
            {% if tache.description %}{{ tache.description }}{% else %}<em style="opacity:.5">â€”</em>{% endif %}
          </span>
        </td>

        <!-- PrioritÃ© -->
        <td>
          {% if tache.priorite == 'haute' %}
            <span class="badge badge-haute">ğŸ”´ Haute</span>
          {% elif tache.priorite == 'moyenne' %}
            <span class="badge badge-moyenne">ğŸ”µ Moyenne</span>
          {% else %}
            <span class="badge badge-faible">âšª Faible</span>
          {% endif %}
        </td>

        <!-- Statut -->
        <td>
          {% if tache.est_terminee %}
            <span class="badge badge-terminee">âœ… TerminÃ©e</span>
          {% else %}
            <span class="badge badge-en-cours">â³ En cours</span>
          {% endif %}
        </td>

        <!-- Date -->
        <td class="date-cell">{{ tache.date_creation|date:"d/m/Y H:i" }}</td>

        <!-- Actions -->
        <td>
          <div class="actions">
            <!-- Toggle statut -->
            <form method="POST" action="{% url 'toggle_statut' tache.pk %}" style="display:inline;">
              {% csrf_token %}
              {% if tache.est_terminee %}
                <button type="submit" class="btn-action btn-toggle-undo" title="Remettre en cours">â†© Annuler</button>
              {% else %}
                <button type="submit" class="btn-action btn-toggle-done" title="Marquer terminÃ©e">âœ“ Terminer</button>
              {% endif %}
            </form>

            <!-- Modifier -->
            <a href="{% url 'modifier_tache' tache.pk %}" class="btn-action btn-edit" title="Modifier">âœï¸</a>

            <!-- Supprimer -->
            <a href="{% url 'supprimer_tache' tache.pk %}" class="btn-action btn-delete" title="Supprimer">ğŸ—‘ï¸</a>
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  {% else %}
  <!-- Ã‰tat vide -->
  <div class="empty-state">
    <div class="empty-icon">ğŸ“­</div>
    <h3>Aucune tÃ¢che trouvÃ©e</h3>
    <p style="margin-bottom:1.5rem;">
      {% if statut or priorite %}
        Aucun rÃ©sultat pour ces filtres.
        <a href="{% url 'liste_taches' %}" style="color:var(--rouge);">Voir toutes les tÃ¢ches</a>
      {% else %}
        Commencez par crÃ©er votre premiÃ¨re tÃ¢che !
      {% endif %}
    </p>
    <a href="{% url 'ajouter_tache' %}" class="nav-btn nav-btn-primary">ï¼‹ CrÃ©er une tÃ¢che</a>
  </div>
  {% endif %}
</div>

{% endblock %}